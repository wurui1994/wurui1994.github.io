<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>DTrace相关 | WuRui</title><meta name="author" content="WuRui"><meta name="copyright" content="WuRui"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="DTrace Likeawesome-dtrace Windows&#x2F;macOS12345sudo dtrace -l | wc -lsudo dtrace -l &gt; dtrace.txtsudo dtrace -ln syscall:::sudo dtrace -ln syscall::: | grep entry | wc -lsudo dtrace -ln syscall:::">
<meta property="og:type" content="article">
<meta property="og:title" content="DTrace相关">
<meta property="og:url" content="https://wurui1994.github.io/2023/06/25/dtrace-like/index.html">
<meta property="og:site_name" content="WuRui">
<meta property="og:description" content="DTrace Likeawesome-dtrace Windows&#x2F;macOS12345sudo dtrace -l | wc -lsudo dtrace -l &gt; dtrace.txtsudo dtrace -ln syscall:::sudo dtrace -ln syscall::: | grep entry | wc -lsudo dtrace -ln syscall:::">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wurui1994.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2023-06-25T15:57:57.000Z">
<meta property="article:modified_time" content="2023-06-27T04:27:46.809Z">
<meta property="article:author" content="WuRui">
<meta property="article:tag" content="dtrace">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wurui1994.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://wurui1994.github.io/2023/06/25/dtrace-like/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.bootcdn.net/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdn.bootcdn.net/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DTrace相关',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-27 12:27:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">101</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">90</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="WuRui"><span class="site-name">WuRui</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">DTrace相关</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-25T15:57:57.000Z" title="发表于 2023-06-25 23:57:57">2023-06-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-27T04:27:46.809Z" title="更新于 2023-06-27 12:27:46">2023-06-27</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span></div></div></div><article class="post-content" id="article-container"><h1 id="DTrace-Like"><a href="#DTrace-Like" class="headerlink" title="DTrace Like"></a>DTrace Like</h1><p><a target="_blank" rel="noopener" href="https://github.com/xen0l/awesome-dtrace">awesome-dtrace</a></p>
<h2 id="Windows-x2F-macOS"><a href="#Windows-x2F-macOS" class="headerlink" title="Windows&#x2F;macOS"></a>Windows&#x2F;macOS</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo dtrace -l | <span class="built_in">wc</span> -l</span><br><span class="line">sudo dtrace -l &gt; dtrace.txt</span><br><span class="line">sudo dtrace -<span class="built_in">ln</span> syscall:::</span><br><span class="line">sudo dtrace -<span class="built_in">ln</span> syscall::: | grep entry | <span class="built_in">wc</span> -l</span><br><span class="line">sudo dtrace -<span class="built_in">ln</span> syscall::: | grep entry| grep \<span class="comment"># | wc -l</span></span><br></pre></td></tr></table></figure>

<h2 id="macOS-kdebug"><a href="#macOS-kdebug" class="headerlink" title="macOS kdebug"></a>macOS kdebug</h2><p><a target="_blank" rel="noopener" href="https://github.com/apple-oss-distributions/xnu/blob/main/bsd/kern/trace_codes">https://github.com/apple-oss-distributions/xnu/blob/main/bsd/kern/trace_codes</a><br>cat &#x2F;usr&#x2F;share&#x2F;misc&#x2F;trace.codes  | grep BSC_<br>557个 多出来的5个<br>0x40e0104       BSC_msync_extended_info<br>0x40e0264       BSC_pread_extended_info<br>0x40e0268       BSC_pwrite_extended_info<br>0x40e0314       BSC_mmap_extended_info<br>0x40f0314       BSC_mmap_extended_info2</p>
<p>win11 21H2 22000.856 系统调用 474个 Nt开头<br>macOS 10.15 系统调用 552个 无名称 #开头 121个<br>[Darwin Kernel Version 19.6.0: Tue Jun 21 21:18:39 PDT 2022; root:xnu-6153.141.66~1&#x2F;RELEASE_X86_64 x86_64]</p>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo bpftrace -l &gt; bpftrace.txt</span><br><span class="line">sudo bpftrace -l <span class="string">&#x27;t:syscalls:&#x27;</span></span><br><span class="line">sudo bpftrace -l <span class="string">&#x27;t:syscalls:sys_enter_*&#x27;</span> | <span class="built_in">wc</span> -l</span><br><span class="line">sudo bpftrace -l <span class="string">&#x27;t:syscalls:sys_enter_*&#x27;</span> &gt; syscalls.txt</span><br><span class="line">sed -i <span class="string">&#x27;s/tracepoint:syscalls:sys_enter_//&#x27;</span> syscalls.txt</span><br><span class="line">sudo bpftrace -l <span class="string">&#x27;t:syscalls:sys_enter_*&#x27;</span> | sed  <span class="string">&#x27;s/tracepoint:syscalls:sys_enter_//&#x27;</span> &gt; syscalls.txt</span><br></pre></td></tr></table></figure>
<p>manjaro 系统调用 344个<br>[Linux wurui 5.15.60-1-MANJARO #1 SMP PREEMPT Thu Aug 11 13:14:05 UTC 2022 x86_64 GNU&#x2F;Linux]<br>sudo ls &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;syscalls&#x2F; &gt; syscalls_kernel.txt</p>
<h1 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h1><p>用户自定义事件收集<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zkweb/p/8126303.html">https://www.cnblogs.com/zkweb/p/8126303.html</a><br>etw lttng ctf(DTrace)<br>Qt 6<br>corelib&#x2F;tracing</p>
<p>c 语言使用lttng<br><a target="_blank" rel="noopener" href="http://t.zoukankan.com/rongfengliang-p-12905940.html">http://t.zoukankan.com/rongfengliang-p-12905940.html</a><br>tracepoint&#x2F;do_tracepoint&#x2F;tracepoint_enabled [#include &lt;lttng&#x2F;tracepoint-event.h&gt;]<br>LTTng原理<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/557393806">https://zhuanlan.zhihu.com/p/557393806</a></p>
<p>etw<br>TraceLoggingWrite&#x2F;TraceLoggingProviderEnabled<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows/win32/tracelogging/tracelogging-wrapper-macros">https://learn.microsoft.com/zh-cn/windows/win32/tracelogging/tracelogging-wrapper-macros</a><br>有四种主要类型的提供程序：MOF (经典) 提供程序、WPP 提供程序、基于清单的提供程序和 TraceLogging 提供程序。<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows/win32/etw/about-event-tracing">https://learn.microsoft.com/zh-cn/windows/win32/etw/about-event-tracing</a><br>EventPipe 是类似于 ETW 或 LTTng 的运行时组件，可用于收集跟踪数据。 EventPipe 的目标是使 .NET 开发人员能够轻松地跟踪其 .NET 应用程序，而无需依赖于平台特定的 OS 本机组件（如 ETW 或 LTTng）。<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/core/diagnostics/eventpipe">https://learn.microsoft.com/zh-cn/dotnet/core/diagnostics/eventpipe</a></p>
<p>dtrace<br>自定义的探测器USDT<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/dustzhu/article/details/103686556">https://blog.csdn.net/dustzhu/article/details/103686556</a><br>dtrace linux_将DTrace探针添加到您的应用程序<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/cusi77914/article/details/107113729">https://blog.csdn.net/cusi77914/article/details/107113729</a></p>
<p>一文教你如何使用 eBPF 检测分析用户态程序<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/580656180">https://zhuanlan.zhihu.com/p/580656180</a><br><a target="_blank" rel="noopener" href="https://www.cnxct.com/ebpf-uprobe-userspace-app/">https://www.cnxct.com/ebpf-uprobe-userspace-app/</a></p>
<p>浅谈动态跟踪技术之DTrace<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6acd36976fba">https://www.jianshu.com/p/6acd36976fba</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DTRACE_LABEL(p, n)                                                                      \</span></span><br><span class="line"><span class="meta"> <span class="string">&quot;__dtrace_probe$&quot;</span> DTRACE_TOSTRING(%=__LINE__) DTRACE_STRINGIFY(_##p##___##n) <span class="string">&quot;:&quot;</span> <span class="string">&quot;\n\t&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>Apple_OSS&#x2F;xnu&#x2F;bsd&#x2F;sys&#x2F;sdt.h</p>
<ul>
<li>The DTRACE_PROBE*() macros are not supported on Mac OS X – instead see</li>
<li>“BUILDING CODE CONTAINING USDT PROBES” in the dtrace(1) manpage</li>
</ul>
<p>drace_note.md</p>
<p>OpenDTrace<br><a target="_blank" rel="noopener" href="https://github.com/orgs/opendtrace/repositories">https://github.com/orgs/opendtrace/repositories</a></p>
<p>OpenDTrace Specification version 1.0<br><a target="_blank" rel="noopener" href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-924.pdf">https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-924.pdf</a></p>
<p>Dtrace4Linux<br><a target="_blank" rel="noopener" href="https://github.com/dtrace4linux/linux">https://github.com/dtrace4linux/linux</a></p>
<p>DTrace Tools<br><a target="_blank" rel="noopener" href="https://www.brendangregg.com/dtrace.html">https://www.brendangregg.com/dtrace.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.brendangregg.com/books.html">https://www.brendangregg.com/books.html</a></p>
<h1 id="Linux-Tracer"><a href="#Linux-Tracer" class="headerlink" title="Linux Tracer"></a>Linux Tracer</h1><h2 id="ftrace"><a href="#ftrace" class="headerlink" title="ftrace"></a>ftrace</h2><p>sudo pacman -S trace-cmd<br>GUI –&gt; KernelShark</p>
<h2 id="strace-x2F-ltrace-库函数"><a href="#strace-x2F-ltrace-库函数" class="headerlink" title="strace&#x2F;ltrace(库函数)"></a>strace&#x2F;ltrace(库函数)</h2><h2 id="babeltrace2-LTTng"><a href="#babeltrace2-LTTng" class="headerlink" title="babeltrace2(LTTng)"></a>babeltrace2(LTTng)</h2><h2 id="ktap-lua"><a href="#ktap-lua" class="headerlink" title="ktap(lua)"></a>ktap(lua)</h2><h2 id="bpftrace"><a href="#bpftrace" class="headerlink" title="bpftrace"></a>bpftrace</h2><p><a target="_blank" rel="noopener" href="https://github.com/iovisor/bpftrace">https://github.com/iovisor/bpftrace</a><br><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/703028">https://developer.aliyun.com/article/703028</a><br><a target="_blank" rel="noopener" href="https://www.brendangregg.com/blog/2018-10-08/dtrace-for-linux-2018.html">https://www.brendangregg.com/blog/2018-10-08/dtrace-for-linux-2018.html</a><br><a target="_blank" rel="noopener" href="https://www.brendangregg.com/blog/2016-10-27/dtrace-for-linux-2016.html">https://www.brendangregg.com/blog/2016-10-27/dtrace-for-linux-2016.html</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -r</span><br><span class="line">pacman -Ss headers | grep linux</span><br><span class="line">sudo pacman -S linux515-headers</span><br><span class="line">sudo pacman -S bcc-tools python-bcc</span><br><span class="line"><span class="built_in">export</span> PATH=/usr/share/bcc/tools/:<span class="variable">$PATH</span></span><br><span class="line">sudo execsnoop</span><br><span class="line">sudo opensnoop</span><br><span class="line"></span><br><span class="line">bpftrace -e <span class="string">&#x27;uprobe:/bin/bash:readline &#123; printf(&quot;read a line\n&quot;); &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;uprobe:./a.out:sigHandler &#123; printf(&quot;sigHandler called\n&quot;); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>sudo pacman -S bpftrace</p>
<figure class="highlight sh"><figcaption><span>sudo</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -l <span class="string">&#x27;t:syscalls:*&#x27;</span></span><br><span class="line">bpftrace -l &gt; bpftrace.txt</span><br><span class="line">bpftrace -l <span class="string">&#x27;t:syscalls:*&#x27;</span></span><br><span class="line">bpftrace -l <span class="string">&#x27;t:syscalls:sys_enter_*&#x27;</span> | <span class="built_in">wc</span> -l</span><br><span class="line">bpftrace -l <span class="string">&#x27;t:syscalls:sys_enter_*&#x27;</span> &gt; syscalls.txt</span><br><span class="line">sed -i <span class="string">&#x27;s/tracepoint:syscalls:sys_enter_//&#x27;</span> syscalls.txt</span><br><span class="line">bpftrace -l <span class="string">&#x27;t:syscalls:sys_enter_*&#x27;</span> | sed  <span class="string">&#x27;s/tracepoint:syscalls:sys_enter_//&#x27;</span> &gt; syscalls.txt</span><br><span class="line"><span class="comment"># bpftrace -l &#x27;kprobe:*&#x27;</span></span><br><span class="line"><span class="comment"># bpftrace -l &#x27;t:syscalls:*openat*</span></span><br><span class="line"><span class="comment"># bpftrace -l &#x27;kprobe:tcp*,trace</span></span><br><span class="line"><span class="comment"># bpftrace -l &#x27;k:*socket*,tracepoint:syscalls:*tcp*&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_enter_connect &#123; printf(&quot;%s is connect.\n&quot;, comm); &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_enter_connect &#123; printf(&quot;%s is connect %s.\n&quot;, comm, ntop(((struct sockaddr_in *)args-&gt;uservaddr)-&gt;sin_addr.s_addr)); &#125;&#x27;</span></span><br><span class="line">ping baidu.com -c1</span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_enter_openat &#123; printf(&quot;%s %s\n&quot;, comm, str(args-&gt;filename)); &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_enter_execve &#123; printf(&quot;%s %s\n&quot;, comm, str(args-&gt;filename)); &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_enter_execve &#123; printf(&quot;%s called %s\n&quot;, comm, str(args-&gt;filename)); &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_enter_execve &#123; join(args-&gt;argv); &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;int main()&#123;return 0;&#125;&#x27;</span> | gcc -xc -o bin -</span><br><span class="line">bpftrace -e <span class="string">&#x27;uprobe:./bin:main &#123; printf(&quot;main called\n&quot;); &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;uprobe:./bin:main &#123; printf(&quot;main called\n&quot;); &#125;&#x27;</span> -c <span class="string">&#x27;./bin&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:raw_syscalls:sys_enter &#123; @syscalls = count(); &#125;</span></span><br><span class="line"><span class="string">    interval:s:1 &#123; print(@syscalls); clear(@syscalls); &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">bpftrace -lv <span class="string">&#x27;tracepoint:syscalls:sys_enter_connect&#x27;</span></span><br><span class="line"></span><br><span class="line">bpftrace -e <span class="string">&#x27;iter:task &#123; printf(&quot;%s:%d\n&quot;, ctx-&gt;task-&gt;comm, ctx-&gt;task-&gt;pid); &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;iter:task_file &#123; printf(&quot;%s:%d %d:%s\n&quot;, ctx-&gt;task-&gt;comm, ctx-&gt;task-&gt;pid, ctx-&gt;fd, path(ctx-&gt;file-&gt;f_path)); &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">bpftrace -e <span class="string">&#x27;kprobe:do_nanosleep &#123; printf(&quot;%s\n&quot;, ksym(reg(&quot;ip&quot;))); &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;int main()&#123;return 0;&#125;&#x27;</span> | gcc -g -xc -o bin -</span><br><span class="line"><span class="comment"># bpftrace -e &#x27;uprobe:./bin:main &#123; printf(&quot;%s\n&quot;, usym(reg(&quot;ip&quot;))); &#125;&#x27; -c &#x27;./bin&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_enter_sendmsg &#123; printf(&quot;%s =&gt; &quot;, comm);</span></span><br><span class="line"><span class="string">    cat(&quot;/proc/%d/cmdline&quot;, pid); printf(&quot;\n&quot;) &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;kprobe:vfs_read &#123; @[comm] = count(); &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">bpftrace -l <span class="string">&#x27;tracepoint:syscalls:sys_enter_*&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:sched:sched* &#123; @[probe] = count(); &#125; interval:s:5 &#123; exit(); &#125;&#x27;</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:sched:sched_switch &#123; @[kstack] = count(); &#125; interval:s:2 &#123; exit(); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>perf<br>sudo pacman -S perf</p>
<p>eBPF<br><a target="_blank" rel="noopener" href="https://ebpf.io/">https://ebpf.io/</a><br><a target="_blank" rel="noopener" href="https://www.brendangregg.com/ebpf.html">https://www.brendangregg.com/ebpf.html</a><br><a target="_blank" rel="noopener" href="https://github.com/zoidbergwill/awesome-ebpf">https://github.com/zoidbergwill/awesome-ebpf</a></p>
<p><a target="_blank" rel="noopener" href="https://jishuin.proginn.com/p/763bfbd73692">https://jishuin.proginn.com/p/763bfbd73692</a> eBPF 介绍<br>在很多情况下，并不直接使用 eBPF，而是通过 Cilium、bcc 或 bpftrace 等项目间接使用，它们在 eBPF 之上提供了一层抽象，无需直接编写程序而是提供了一些能力，由 eBPF 来实现。<br>要是没有上层抽象的话，就要直接编写程序了。Linux 内核期望 ePBF 程序以字节码的形式加载。直接编写字节码不太可能，实际开发中更常见的是使用 LLVM 等编译器套件将伪 C 代码编译成 eBPF 字节码。<br>Cilium -&gt; 容器</p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/947869">https://developer.aliyun.com/article/947869</a> 深入浅出eBPF｜你要了解的7个核心问题<br>sudo ls &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events </p>
<p><a target="_blank" rel="noopener" href="https://jishuin.proginn.com/p/763bfbd6368e">https://jishuin.proginn.com/p/763bfbd6368e</a> eBPF 基本架构及使用<br>总体上XDP性能全面弱于DPDK（但是差距不大）<br>XDP优势：可编程、内核协同工作[eBPF在内核]</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/453005342">https://zhuanlan.zhihu.com/p/453005342</a> XDP技术——Linux网络处理的高速公路</p>
<p><a target="_blank" rel="noopener" href="https://www.ithome.com/0/620/449.htm">https://www.ithome.com/0/620/449.htm</a> XDP for Windows<br><a target="_blank" rel="noopener" href="https://github.com/microsoft/xdp-for-windows/">https://github.com/microsoft/xdp-for-windows/</a><br><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/534498790">https://www.zhihu.com/question/534498790</a></p>
<p><a target="_blank" rel="noopener" href="https://lwn.net/Articles/857215/">https://lwn.net/Articles/857215/</a> eBPF for Windows<br><a target="_blank" rel="noopener" href="https://github.com/Microsoft/ebpf-for-windows">https://github.com/Microsoft/ebpf-for-windows</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/iovisor/ubpf">https://github.com/iovisor/ubpf</a> Userspace eBPF VM </p>
<p>CPU Flame Graphs<br><a target="_blank" rel="noopener" href="https://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html">https://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html</a><br>Linux perf<br>eBPF profile<br>DTrace<br>Xperf [<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows-hardware/test/wpt/xperf-command-line-reference]">https://docs.microsoft.com/zh-cn/windows-hardware/test/wpt/xperf-command-line-reference]</a></p>
<p>Kernel Debug<br>Linux –&gt; ftrace(tracepoint&#x2F;kprobe&#x2F;uprobe,etc)<br>ftrace 的主要作者 Steven Rostedt 创建了 trace-cmd，我创建了 perf-tools 集合。 我最大的抱怨是它不可编程，所以你不能，例如，保存和获取时间戳、计算延迟，然后将其存储为直方图。 您需要以一定成本将事件转储到用户级别和后处理。 它可以通过 eBPF 变得可编程。<br>macOS –&gt; kdebug(ktrace)&#x2F;dtrace?<br>Windows –&gt; windbg(kernel-mode)&#x2F;dtrace-on-windows?</p>
<p>kdebug 单用户 一次只能有一个运行 第二个调用sysctl会返回失败<br>$(OBJROOT)&#x2F;syscall.codes: $(TARGET)&#x2F;bsd.syscalls.master<br>$(OBJROOT)&#x2F;trace.codes: $(SRCROOT)&#x2F;bsd&#x2F;kern&#x2F;trace_codes $(OBJROOT)&#x2F;syscall.codes<br><a target="_blank" rel="noopener" href="https://github.com/apple-oss-distributions/xnu/blob/main/bsd/kern/syscalls.master">https://github.com/apple-oss-distributions/xnu/blob/main/bsd/kern/syscalls.master</a><br><a target="_blank" rel="noopener" href="https://github.com/apple-oss-distributions/xnu/blob/main/bsd/kern/trace_codes">https://github.com/apple-oss-distributions/xnu/blob/main/bsd/kern/trace_codes</a></p>
<p>sysctl CTL_KERN, KERN_KDEBUG, KERN_KDREADTR<br><a target="_blank" rel="noopener" href="http://newosxbook.com/tools/kdv.html">http://newosxbook.com/tools/kdv.html</a><br>Apple’s own utilities - fs_usage(1), sc_usage(1), latency(1) and trace(1) - all part of the system_cmds package, use this facility. The Apple utilities impose filters on KDebug, and don’t tap the full power of this amazing facility. The fabulous Instruments.app also uses kdebug, which it also invokes on the device with the help of iprofiler(1), present both in OS X and in iOS (in the DeveloperDiskImage)<br><a target="_blank" rel="noopener" href="https://github.com/apple-oss-distributions/system_cmds.git">https://github.com/apple-oss-distributions/system_cmds.git</a><br>fs_usage目前使用ktrace(ktrace_event_t) see <code>man ktrace</code><br><a target="_blank" rel="noopener" href="https://github.com/Torrekie/apple_internal_sdk">https://github.com/Torrekie/apple_internal_sdk</a></p>
<p>ktrace info<br>tailspin info</p>
<p>sysctl ktrace<br>sysctl kperf<br>sysctl kern.coredump<br>sysctl kern.corefile</p>
<p>coredump太大 –&gt; corpses<br>task_map_corpse_info</p>
<p>kperf subset –&gt; kpc</p>
<p>Trace &amp; Debug<br>proc_info<br>stackshot<br>microstackshot<br>–&gt; systemstats<br>&#x2F;var&#x2F;db&#x2F;systemstats<br>logd<br>&#x2F;var&#x2F;db&#x2F;diagnostics&#x2F;</p>
<p>DTrace<br>dtrace -l | tr -s ‘ ‘ | tr -d ‘[0-9]’ | cut -d ‘ ‘ -f2 | sort -u &gt; dtrace_providers.txt<br><a target="_blank" rel="noopener" href="https://awesome-dtrace.com/">https://awesome-dtrace.com/</a><br><a target="_blank" rel="noopener" href="https://www.codenong.com/35752326/">https://www.codenong.com/35752326/</a> 关于macos：Dtrace打印父进程命令<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/daizhj/articles/3178257.html">https://www.cnblogs.com/daizhj/articles/3178257.html</a> MAC OS 内核跟踪监视工具dtrace 使用示例说明</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dtrace -n <span class="string">&#x27;syscall::connect:entry &#123; printf(&quot;%s is connect.\n&quot;, curpsinfo-&gt;pr_psargs); &#125;&#x27;</span></span><br><span class="line">curl -I baidu.com</span><br><span class="line">dtrace -n <span class="string">&#x27;syscall::execve:entry &#123; printf(&quot;%s is execve.\n&quot;, curpsinfo-&gt;pr_psargs); &#125;&#x27;</span></span><br><span class="line">dtrace -n <span class="string">&#x27;syscall::execve:entry &#123; printf(&quot;%s %s&quot;, execname, copyinstr(arg0)); &#125;&#x27;</span></span><br><span class="line">dtrace -n <span class="string">&#x27;syscall::open*:entry &#123; printf(&quot;%s %s&quot;, execname, copyinstr(arg0)); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zengkefu/p/5632802.html">https://www.cnblogs.com/zengkefu/p/5632802.html</a>  Choosing a Linux Tracer–&gt;Brendan Gregg’s Blog<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zengkefu/p/5726530.html">https://www.cnblogs.com/zengkefu/p/5726530.html</a>  利用DTrace实时检测MySQL<br>DTrace最好的一个功能是一个叫做“flowindent”的编译指示选项。这个函数会相应地显示entry和return并生成一个逻辑树，以便用户能了解其内部的函数调用关系。<br><a target="_blank" rel="noopener" href="http://myaut.github.io/dtrace-stap-book/">http://myaut.github.io/dtrace-stap-book/</a> Dynamic Tracing with DTrace &amp; SystemTap<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zengkefu/p/6550976.html">https://www.cnblogs.com/zengkefu/p/6550976.html</a> windows XP 下的DTRACE 跟踪 学习<br><a target="_blank" rel="noopener" href="https://github.com/prash-wghats/DTrace-win32">https://github.com/prash-wghats/DTrace-win32</a></p>
<p><a target="_blank" rel="noopener" href="https://illumos.org/books/dtrace/preface.html">https://illumos.org/books/dtrace/preface.html</a> Dynamic Tracing Guide<br><a target="_blank" rel="noopener" href="https://github.com/rmustacc/illumos-docbooks">https://github.com/rmustacc/illumos-docbooks</a></p>
<p>TODO<br>JIT eBPF&#x2F;cling mprotect确认<br>instruments<br>iprofiler (Older versions of MacOS (Sierra))<br><a target="_blank" rel="noopener" href="https://github.com/jfgiraldoa/moose/blob/master/modules/doc/content/application_development/profiling.md">https://github.com/jfgiraldoa/moose/blob/master/modules/doc/content/application_development/profiling.md</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zengkefu/p/6882921.html">https://www.cnblogs.com/zengkefu/p/6882921.html</a> 白话火焰图—火丁笔记<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zengkefu/p/7502433.html">https://www.cnblogs.com/zengkefu/p/7502433.html</a> DTrace memory leak 内存泄露</p>
<p>dtrace -x ustackframes&#x3D;100 -n ‘profile-97 &#x2F;pid &#x3D;&#x3D; 12345&#x2F; { @[ustack()] &#x3D; count(); } tick-60s { exit(0); }’ -o out.user_stacks</p>
<p>dtrace -l -n profile-*<br>dtrace -x ustackframes&#x3D;100 -n ‘profile-997  &#x2F;execname &#x3D;&#x3D; “test”&#x2F; { @[ustack()] &#x3D; count(); }’ -o user_stacks.txt -c ‘.&#x2F;test’</p>
<p>gprof2dot -f dtrace user_stacks.txt | dot -Tpng -o output.png</p>
<p>Instruments<br>instruments -t “Time Profiler” .&#x2F;a.out foo.txt 20<br>instruments -t “Time Profiler” .&#x2F;test<br>instruments -l 30000 -t “Time Profiler” -p 5773</p>
<p>MTuner is a C&#x2F;C++ memory profiler and memory leak finder for Windows, PlayStation 4 and 3, Android and other platforms</p>
<p>分析系统自带CPU采样格式<br>macOS sample&#x2F;活动监视器<br>Windows dump&#x2F;任务管理器<br>Linux perf?</p>
<p>Userspace eBPF VM<br><a target="_blank" rel="noopener" href="https://github.com/iovisor/ubpf">ubpf</a><br><a target="_blank" rel="noopener" href="https://github.com/microsoft/ebpf-for-windows">ebpf-for-windows</a><br><a target="_blank" rel="noopener" href="https://github.com/brendangregg/DTrace-book-scripts">DTrace-book-scripts</a><br><a target="_blank" rel="noopener" href="https://github.com/brendangregg/DTrace-tools">DTrace-tools</a><br><a target="_blank" rel="noopener" href="https://github.com/zoidbergwill/awesome-ebpf">awesome-ebpf</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/myaut/dtrace-stap-book">dtrace-stap-book</a><br><a target="_blank" rel="noopener" href="https://github.com/opendtrace/toolkit">toolkit</a><br><a target="_blank" rel="noopener" href="https://github.com/brendangregg/FlameGraph">FlameGraph</a><br><a target="_blank" rel="noopener" href="https://github.com/frida/frida">frida</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://wurui1994.github.io">WuRui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wurui1994.github.io/2023/06/25/dtrace-like/">https://wurui1994.github.io/2023/06/25/dtrace-like/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wurui1994.github.io" target="_blank">WuRui</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/dtrace/">dtrace</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.bootcdn.net/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechatpay.png" target="_blank"><img class="post-qr-code-img" src="/img/wechatpay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/26/dtrace-profile/" title="DTrace分析性能"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">DTrace分析性能</div></div></a></div><div class="next-post pull-right"><a href="/2023/06/25/website-note/" title="网站记录"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">网站记录</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/06/25/dtrace-on-windows/" title="Windows上的DTrace"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-25</div><div class="title">Windows上的DTrace</div></div></a></div><div><a href="/2023/06/26/dtrace-profile/" title="DTrace分析性能"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-26</div><div class="title">DTrace分析性能</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">WuRui</div><div class="author-info__description">每天都是新的一天</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">101</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">90</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wurui1994" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/img/qq.jpg" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/img/wechat.jpg" target="_blank" title="微信"><i class="fab fa-weixin"></i></a><a class="social-icon" href="mailto:1341531859@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn"></i><span>公告</span></div><div class="announcement_content">这里是我的博客, <a href=https://www.cnblogs.com/wurui1994/>旧博客地址</a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DTrace-Like"><span class="toc-number">1.</span> <span class="toc-text">DTrace Like</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-x2F-macOS"><span class="toc-number">1.1.</span> <span class="toc-text">Windows&#x2F;macOS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#macOS-kdebug"><span class="toc-number">1.2.</span> <span class="toc-text">macOS kdebug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux"><span class="toc-number">1.3.</span> <span class="toc-text">Linux</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Trace"><span class="toc-number">2.</span> <span class="toc-text">Trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux-Tracer"><span class="toc-number">3.</span> <span class="toc-text">Linux Tracer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ftrace"><span class="toc-number">3.1.</span> <span class="toc-text">ftrace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#strace-x2F-ltrace-%E5%BA%93%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text">strace&#x2F;ltrace(库函数)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babeltrace2-LTTng"><span class="toc-number">3.3.</span> <span class="toc-text">babeltrace2(LTTng)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ktap-lua"><span class="toc-number">3.4.</span> <span class="toc-text">ktap(lua)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bpftrace"><span class="toc-number">3.5.</span> <span class="toc-text">bpftrace</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/02/media-guide/" title="学习入门">学习入门</a><time datetime="2024-03-02T01:00:12.000Z" title="发表于 2024-03-02 09:00:12">2024-03-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/22/clipboard-note/" title="clipboard笔记">clipboard笔记</a><time datetime="2023-10-22T08:54:25.000Z" title="发表于 2023-10-22 16:54:25">2023-10-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/04/optimize-note/" title="优化相关">优化相关</a><time datetime="2023-08-04T06:51:45.000Z" title="发表于 2023-08-04 14:51:45">2023-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/04/love-note/" title="关于爱情">关于爱情</a><time datetime="2023-08-04T00:35:24.000Z" title="发表于 2023-08-04 08:35:24">2023-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/20/dopamine-note/" title="多巴胺相关">多巴胺相关</a><time datetime="2023-07-20T06:47:32.000Z" title="发表于 2023-07-20 14:47:32">2023-07-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By WuRui</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>function getGiscusTheme (theme) {
  return theme === 'dark' ? 'dark' : 'light'
}

function loadGiscus () {
  const config = Object.assign({
    src: 'https://giscus.app/client.js',
    'data-repo': 'wurui1994/wurui1994.github.io',
    'data-repo-id': 'R_kgDOJzB0HA',
    'data-category-id': 'DIC_kwDOJzB0HM4CXeHj',
    'data-lang': 'zh-CN',
    'data-mapping': 'pathname',
    'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
    'data-reactions-enabled': '1',
    crossorigin: 'anonymous',
    async: true
  },null)

  let ele = document.createElement('script')
  for (let key in config) {
    ele.setAttribute(key, config[key])
  }
  document.getElementById('giscus-wrap').insertAdjacentElement('afterbegin',ele)
}

function changeGiscusTheme (theme) {
  function sendMessage(message) {
    const iframe = document.querySelector('iframe.giscus-frame')
    if (!iframe) return
    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app')
  }

  sendMessage({
    setConfig: {
      theme: getGiscusTheme(theme)
    }
  });
}

btf.addModeChange('giscus', changeGiscusTheme)

if ('Giscus' === 'Giscus' || !false) {
  if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
  else loadGiscus()
} else {
  function loadOtherComment () {
    loadGiscus()
  }
}</script></div><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/butterfly-extsrc/1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>